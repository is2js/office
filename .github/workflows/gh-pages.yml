name: Github Pages
on:
  push:
    branches:
      - master  # Set a branch name to trigger deployment
    pull_request:

jobs:
  deploy: # actions > 좌측 탭으로 나올 job 이름
    runs-on: ubuntu-latest # 시작OS
    permissions: # 권한 설정
      contents: write
    concurrency: # 동시성 설정
      group: ${{ github.workflow }}-${{ github.ref }} # 동시성 그룹 설정
    steps:
      - run: echo "🎉 The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "🎉 The job is now running on a ${{ runner.os }} server hosted by Github!"
      - run: echo "🔎 The name  of your branch is  ${{ github.ref }} and your repository is ${{ github.repository }}."

      - name: Checkout Repository # 체크아웃 => repository의 코드들을 runner로 클론후 checkout까지
        uses: actions/checkout@v3
      - run: echo "?? The ${{  github.repository }} repository has been cloned out to ${{ github.workspace }} on the runner."

      - name: List files # 파일 목록 출력
        run: |
          ls ${{ github.workspace }}

      - run: echo "🍏 This job's status is ${{ job.status }}."

      - name: Setup python # 파이썬 셋업
        uses: actions/setup-python@v4
        with:
          python-version: '3.11' # 파이썬 버전 설정

      - name: Build site # 로컬 터미널에서 하던 python 패키지 빌드 작업
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          
          pip install -e .
          mdr

#python setup.py install
#mdr
      - name: Deploy Github Pages # gh-pages에 빌드한 것과 함께 배포 (빌드한 내용물을 pull request로 gh-pages 브랜치에 반영)
        uses: peaceiris/actions-gh-pages@v4
        if: ${{ github.ref == 'refs/heads/master' }}
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }} # GH_ACTIONS_TOKEN 도 따로 만들어뒀는데, default token인 듯.
          publish_dir: ./build

