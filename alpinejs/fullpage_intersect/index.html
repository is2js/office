<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>

    <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
    <!--<link rel="stylesheet" href="css/style.css">-->

    <!-- intersect plugin -->
    <!-- Alpine Plugins -->
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/intersect@3.x.x/dist/cdn.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <!-- 1. youtube iframe api Ï∂îÍ∞Ä -->
    <script src="https://www.youtube.com/iframe_api"></script>

    <!--  styleÌÉúÍ∑∏Î°ú ÌïÑÏöîÌïú css ÎØ∏Î¶¨ ÏûëÏÑ±-->
    <style>
        [x-cloak] {
            display: none !important;
        }

        .bg-black {
            background-color: black;
        }

        /*   secetionÏù¥ sticky Ìö®Í≥ºÎ•º Ï£ºÎ†§Î©¥ cssÎ°ú Ï£ºÎ©¥ ÎêúÎã§. */
        .sections {
            /* body scrollÎåÄÏã† section scrollÏù¥ ÎêòÍ∏∞ ÏúÑÌï¥ÏÑ†, sectionsÎ∂ÄÎ™®Ïóê overflow:auto */
            overflow: auto;
            height: 100vh;
            /* y mandatoryÎ°ú snapping Ìö®Í≥ºÎ•º ÎßåÎì†Îã§.*/
            -ms-scroll-snap-type: y mandatory;

            scroll-snap-type: y mandatory;

            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            /* ÎßàÏßÄÎßâ, ÏûêÏãùÎì§ÏùÄ Ïä§ÎÉÖ alignÍπåÏßÄ ÏßÄÏ†ïÌï¥Ï§òÏïº Í±∞Í∏∞Î°ú Ï†ïÎ†¨ÎêúÎã§.*/

            > div {
                scroll-snap-align: center;
            }
        }
    </style>

</head>
<!-- bodyÏóê active ÏÑπÏÖòindex ÏßÄÏ†ï -->
<!-- Ïù¥Ï†ú Ìù∞/Í≤Ä ÌÖåÎßàÎ°ú ÎÇòÎà†ÏÑú ÏûëÎèôÌï† Ïàò ÏûàÎèÑÎ°ù Ï≤´Î≤àÏß∏Îäî white: true Î≥ÄÏàòÎ•º Ï¥àÍ∏∞ÌôîÌïòÍ≥† -->
<body class="bg-gray-100"
      x-data="{
        isAutoPlay: false,
        autoPlayDuration: 1500, // ÏûêÎèô Ïä¨ÎùºÏù¥Îìú Ï†ÑÌôò Í∞ÑÍ≤©
        pauseTimeoutDuration: 3000, // Ìú† Îì±ÏúºÎ°ú ÏùºÏãúÏ†ïÏßÄ ÌõÑ Ïû¨ÏãúÏûë ÎåÄÍ∏∞ÏãúÍ∞Ñ
        slides: [
            {
                youtubeId: 'pbGSI140UPw',
                title: 'Ï≤´Î≤àÏß∏ ÏòÅÏÉÅÍ¥ëÍ≥†',
                subtitle: 'Ïù¥ ÏòÅÏÉÅÏùÄ MuteÏÑ§Ï†ïÏù¥ ÏïàÎêòÏñ¥ÏûàÏäµÎãàÎã§.',

            },
            {
                //image: 'section1.png',
                image: 'https://picstargram.s3.ap-northeast-2.amazonaws.com/post/93a4051d-089c-4bbe-bbea-8e2dc8298190_4700.webp',
                title: 'Ï≤´Î≤àÏß∏ ÏÇ¨ÏßÑÍ¥ëÍ≥†',
                subtitle: 'titleÏù¥ Îì§Ïñ¥Í∞ÄÎ©¥, ÌôîÎ©¥ÏùÄ ÏïΩÍ∞Ñ Ïñ¥Îë°Í≤å',
            },
            {
                youtubeId: 'Vzy1DFfKF4E',
                title: 'ÎëêÎ≤àÏß∏ ÏòÅÏÉÅÍ¥ëÍ≥†(Muted)',
                subtitle: 'ÎãπÏã†ÏùÑ Ï¥àÎåÄÌï©ÎãàÎã§',
                isMute: true,
            },
            {
                //image: 'section2.png',
                //title: 'ÎëêÎ≤àÏß∏ ÏÇ¨ÏßÑÍ¥ëÍ≥†',
                //subtitle: 'ÏïΩÏπ®ÏπòÎ£åÎäî ÌòÑÎåÄ ÌïúÏùòÏõêÏóêÏÑú ÏπòÎ£åÌö®Í≥ºÎ•º ÏúÑÌï¥ ÏπòÎ£åÏóê Ìè¨Ìï®Îê©ÎãàÎã§.',
                image: 'https://picstargram.s3.ap-northeast-2.amazonaws.com/post/9a6ebc3f-ff00-46d9-b395-248cf7fc1642_4700.webp',
            },
        ],
        activeSection: 1,
        isPaused: false,
        autoSlideInterval: null,
        autoResumeTimeout: null,
        scrollToSection(index) {
            const el = document.getElementById(`section-${index}`);
            if (el) el.scrollIntoView({ behavior: 'smooth' });
        },
        increaseActiveSection(index) {
            this.activeSection = (index % this.slides.length) + 1;
        },
        isActiveSection(index) {
            return this.activeSection === index + 1;
        },
        hasActiveSectionTitle() {
            const currentSlide = this.slides[this.activeSection - 1];
            return currentSlide && currentSlide.title && currentSlide.title != undefined;
        },
        startAutoSlide() {
            this.autoSlideInterval = setInterval(() => {
                if (!this.isPaused) {
                    this.activeSection = (this.activeSection % this.slides.length) + 1;
                    this.scrollToSection(this.activeSection - 1);
                }
            }, this.autoPlayDuration);
        },
        init() {
            if (this.isAutoPlay) {
                this.startAutoSlide();
            }

            // YouTube APIÍ∞Ä Î°úÎìúÎêòÎ©¥ ÌîåÎ†àÏù¥Ïñ¥ Í∞ùÏ≤¥ Ï¥àÍ∏∞Ìôî(unMuteÎ•º ÏúÑÌï¥ ÌïÑÏàò)
            window.onYouTubeIframeAPIReady = () => this.initYouTubePlayers();

            // ÏÇ¨Ïö©Ïûê ÏÉÅÌò∏ÏûëÏö© Ïù¥Î≤§Ìä∏ Í∞êÏßÄ Îì±Î°ù
            this.registerUserInteraction();

        },
        registerUserInteraction() {
            ['click', 'keydown', 'touchstart'].forEach(event =>
                window.addEventListener(event, () => {
                    this.userInteracted = true;
                    console.log('‚úÖ ÏÇ¨Ïö©Ïûê ÏÉÅÌò∏ÏûëÏö© Îì±Î°ùÎê® (Alpine ÎÇ¥Î∂Ä)');
                }, { once: true })
            );
        },

        stopAutoSlide() {
            clearInterval(this.autoSlideInterval);
            this.autoSlideInterval = null;
        },


        controlVideoSection(index) {
            // ÌòÑÏû¨ activeSectionÏùò Ïä¨ÎùºÏù¥ÎìúÍ∞Ä, userInteractÌõÑ & Ï†ÑÏ≤¥ÏùåÏÜåÍ±∞Í∞Ä ÏïÑÎãàÎ©¥, ÏÜåÎ¶¨Î•º ÏºúÍ≥†,  ÎÇòÎ®∏ÏßÄ Ïä¨ÎùºÏù¥ÎìúÎäî ÏùºÏãúÏ†ïÏßÄÌïúÎã§.

              if (this.players.length > 0) {
                    console.log('activeSection', this.activeSection);

                    this.players.forEach((p, idx) => {
                        if (p && typeof p.playVideo === 'function') {
                            if (idx === index) {
                                p.playVideo();
                                if (this.userInteracted  && !this.isMutedAll) {
                                        console.log('üîä unMute ÏãúÎèÑ (ÏÇ¨Ïö©Ïûê ÏÉÅÌò∏ÏûëÏö© Ïù¥ÌõÑ)');
                                        p.unMute();
                                    } else {
                                        console.log('üîá ÏÇ¨Ïö©Ïûê ÏÉÅÌò∏ÏûëÏö© Ï†ÑÏù¥Îùº mute Ïú†ÏßÄ');
                                        p.mute();
                                    }
                            } else {
                                p.pauseVideo();
                            }
                        }
                    });
                }
        },

        togglePause() {
             if (!this.isAutoPlay) {
                this.isAutoPlay = true;
                this.isPaused = false;
                this.init();
            } else {
                this.isPaused = !this.isPaused;
            }


            //  ‚úÖ ÌòÑÏû¨ activeSectionÏùò Ïä¨ÎùºÏù¥ÎìúÍ∞Ä YouTube ÏòÅÏÉÅÏù¥Í≥† isMuteÍ∞Ä ÏïÑÎãå Í≤ΩÏö∞, unMute
            // - Ï≤´Î≤àÏû¨ ÏòÅÏÉÅÏù¥ muteÎ°ú ÏãúÏûëÎêòÍ≥† ÏûàÏùÑ Îïå, ÏûêÎèôÏû¨ÏÉù ÎàåÎü¨ÏÑú unMuteÍ∞Ä ÎêòÎèÑÎ°ù
            this.unMuteActiveSectionForFirstUnmuteVideoSection();
        },
        unMuteActiveSectionForFirstUnmuteVideoSection() {
            const index = this.activeSection - 1;
            const currentSlide = this.slides[index];
            const player = this.players[index];

            if (!this.isMutedAll && currentSlide && currentSlide.youtubeId && !currentSlide.isMute && player && typeof player.unMute === 'function') {
                try {
                    console.log('üîä unMuting current video (section:', index, ')');
                    player.unMute();
                } catch (e) {
                    console.warn('‚ö†Ô∏è unMute Ïã§Ìå®:', e);
                }
            }
        },


        pauseOnInteraction() {
                 const wasPlaying = !this.isPaused; // Ïù∏ÌÑ∞ÎûôÏÖò Ïù¥Ï†Ñ ÏÉÅÌÉúÍ∞Ä Ïû¨ÏÉù Ï§ëÏù¥ÏóàÎäîÏßÄ Ï≤¥ÌÅ¨

                this.isPaused = true;

                // ÏûêÎèôÏû¨ÏÉù Î™®ÎìúÏù¥Î©¥ÏÑú, Ïù¥Ï†Ñ ÏÉÅÌÉúÍ∞Ä Ïû¨ÏÉù Ï§ëÏù¥ÏóàÏùÑ ÎïåÎßå Ïû¨ÏãúÏûë ÌÉÄÏù¥Î®∏ ÏÑ§Ï†ï
                if (this.isAutoPlay && wasPlaying) {
                    clearTimeout(this.pauseTimeout); // Í∏∞Ï°¥ ÌÉÄÏù¥Î®∏ Ï†úÍ±∞

                    this.pauseTimeout = setTimeout(() => {
                        this.isPaused = false;
                    }, this.pauseTimeoutDuration); // Ïòà: 10000ms
                }
        },




        userInteracted: false,
        players: [], // YouTube ÌîåÎ†àÏù¥Ïñ¥ Í∞ùÏ≤¥ Ï†ÄÏû•Ïö©
        initYouTubePlayers() {
                this.slides.forEach((slide, i) => {
                    if (slide.youtubeId && !slide.isMute) {
                        const iframe = document.querySelector(`#yt-${i}`);
                        if (iframe ) {
                            this.players[i] = new YT.Player(iframe, {
                                events: {
                                    'onReady': (event) => {
                                       // // activeSection - 1 (ÌòÑÏû¨ ÌôúÏÑ± Ïä¨ÎùºÏù¥ÎìúÎ©¥ unmute + play)
                                       // if (i === this.activeSection - 1) {
                                       //  console.log('playVideo by onReady', i);
                                       //     event.target.unMute();
                                       //     event.target.playVideo();
                                       // } else {
                                       //     event.target.mute();
                                       //     event.target.pauseVideo();
                                       // }
                                       // // ‚úÖ Ï∂îÍ∞ÄÎêú Î°úÏßÅ: Ï≤´ Î≤àÏß∏ ÏÑπÏÖòÏù¥Í≥† ÏïÑÏßÅ activeSection Ï¥àÍ∏∞Ìôî Ïïà ÎêêÏùÑ Ïàò ÏûàÎäî Í≤ΩÏö∞
                                       // if (i === 0 && this.activeSection === 1 ) {
                                       //     console.log('playVideo by onReady', i);
                                       //     event.target.unMute();
                                       //     event.target.playVideo();
                                       // }
                                    }
                                }
                            });
                        }
                    }
                });
        },

        isMutedAll: false,
        toggleMuteAll() {
            this.isMutedAll = !this.isMutedAll;
            console.log(this.isMutedAll ? 'üîá Ï†ÑÏ≤¥ ÏùåÏÜåÍ±∞Îê®' : 'üîä Ï†ÑÏ≤¥ ÏùåÏÜåÍ±∞ Ìï¥Ï†ú');

            this.players.forEach(p => {
                if (p && typeof p.mute === 'function') {
                    try {
                        this.isMutedAll ? p.mute() : (this.userInteracted && p.unMute());
                    } catch (e) {
                        console.warn('üîÅ mute/unMute Ïã§Ìå®:', e);
                    }
                }
            });
        },


    }"
>

<!-- Ï†ê(dot) ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
<style>

    @keyframes wheelAni {
        0% {
            transform: translate(0, 0);
        }

        50% {
            transform: translate(0, 3px);
        }

        100% {
            transform: translate(0, 0);
        }

    }

    .floatNav {
        z-index: 12;
        margin: 0;
        padding: 0;
        border: 0;
        background: transparent;
        letter-spacing: -0.04rem;

        top: 120px;
        left: 20px;

        & li {
            list-style: none;
            line-height: 1;

            font-size: 14px;
        }

        > .scroll-down {
            &::before {
                content: '';
                display: block;
                width: 14px;
                height: 20px;
                /*https://www.jaseng.co.kr/images/renewal-v3/mouse-w.png*/
                background: url(https://www.jaseng.co.kr/images/renewal-v3/mouse-bk.png) no-repeat 50% 0;
            }

            &::after {
                content: '';
                display: block;
                width: 14px;
                height: 10px;
                margin-top: 5px;
                /*https://www.jaseng.co.kr/images/renewal-v3/mouse-w-arr.png*/
                background: url(https://www.jaseng.co.kr/images/renewal-v3/mouse-bk-arr.png) no-repeat 50% 0;

                animation: wheelAni 0.7s infinite;
            }

            &.white::before {
                background: url(https://www.jaseng.co.kr/images/renewal-v3/mouse-w.png) no-repeat 50% 0;
            }

            &.white::after {
                background: url(https://www.jaseng.co.kr/images/renewal-v3/mouse-w-arr.png) no-repeat 50% 0;
            }
        }

        .bounce {
            animation: wheelAni 0.7s infinite;
        }

    }
</style>
<div class="fixed flex flex-col justify-center space-y-4 px-10
    floatNav
">
    <ul>
        <template x-for="(slide, i) in slides" :key="i">
            <li class="w-auto">
                <a :href="`#section-${i}`"
                   class="cursor flex items-center"
                   x-data="{ hovered: false }"
                   @mouseenter="hovered = true"
                   @mouseleave="hovered = false"
                >
                    <!-- bar -->
                    <span class="inline-block h-10 relative"
                          :class="{
                          'bg-white' : isActiveSection(i),
                          'bg-gray-400' : !isActiveSection(i),
                          }"
                          :style="hovered? 'width: 6px; left: -1px; background-color: #1ECECB;' : 'width: 4px;'"
                    ></span>
                    <!-- title -->
                    <span class="inline-block pl-3 text-sm"
                          :class="{
                                'text-white font-bold': isActiveSection(i),
                                'text-gray-400': !isActiveSection(i),
                                'font-bold': hovered,
                                'bounce': isActiveSection(i)
                                }"
                          :style="hovered ? 'color: #1ECECB;' : ''"
                          x-text="slide.title ? slide.title : 'ÏÑπÏÖò ' + (i+1) + '' "></span>

                </a>
            </li>
        </template>
    </ul>

    <!-- ÎßàÏö∞Ïä§ Ïä§ÌÅ¨Î°§ -->
    <span class="scroll-down block -ml-1 mt-10 h-8.5"
          :class="{'white' : hasActiveSectionTitle() }"
    ></span>

    <!-- Ïû¨ÏÉùÏó¨Î∂Ä -->
    <button @click="togglePause"
            x-data="{hovered: false}"
            @mouseenter="hovered = true"
            @mouseleave="hovered = false"
            class="block -ml-2 px-1 py-1 bg-transparent text-sm"
            :class="hovered ? 'text-white font-bold' : 'text-gray-400'"
    >
        <span x-text="!isAutoPlay ? 'ÏûêÎèôÏû¨ÏÉù' : (isPaused ? 'Îã§ÏãúÏãúÏûë' : 'ÏùºÏãúÏ†ïÏßÄ')"></span>
    </button>


    <!-- üîá Ï†ÑÏ≤¥ ÏùåÏÜåÍ±∞ ÌÜ†Í∏Ä Î≤ÑÌäº -->
    <button
        @click="toggleMuteAll"
        x-data="{hovered: false}"
        @mouseenter="hovered = true"
        @mouseleave="hovered = false"
        class="fixed top-4 right-4 z-12 bg-transparent text-sm px-4 py-2 rounded"
          :class="hovered ? 'text-white font-bold' : 'text-gray-400'"
        x-text="isMutedAll ? 'üîá Ï†ÑÏ≤¥ ÏùåÏÜåÍ±∞ Ìï¥Ï†ú' : 'üîà Ï†ÑÏ≤¥ ÏùåÏÜåÍ±∞'"
    ></button>
</div>

<!-- Ïä¨ÎùºÏù¥Îìú ÏÑπÏÖò -->
<style>
    .sections {
        > div > a {
            /* ÌïÑÎ¶ÑÏùÄ aÌÉúÍ∑∏Ïùò afterÎ°ú Ï§òÏÑú, ÎÇ¥Ïö©Î¨ºÎ≥¥Îã§ Ï†úÏùº ÏïÑÎûò ÍπîÎ¶¨Í≤å ÎëêÍ≥† -> ÎÇ¥Î∂Ä textÎßå z-indexÎ•º Ï∂îÍ∞ÄÎ°ú Ï§ÄÎã§.. */

            &.has-title::after {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.3);
            }

            &.has-no-title-video:after {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgb(71, 85, 105, 0.15);
                /*background-color: rgb(71, 85, 105, 0.05);*/
            }
             &.has-no-title-picture:after {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                /*background-color: rgb(71, 85, 105, 0.05);*/
            }


            /*  youtube  */
            /* 2. Í∑∏ÎûòÏÑú Î∂ÄÎ™®divÎ•º ÏîåÏõå Ï≤òÎ¶¨ÌïòÎäîÎç∞  */

            .video-box {
                position: relative;
                /*height: 0;*/
                /* Ïú†ÌäúÎ∏åÏòÅÏÉÅ ÎπÑÏú®ÏùÑ Í≥†Î†§ÌïòÏó¨ Ï†ÑÏ≤¥ÌôîÎ©¥ ÎêòÍ≤å ÌïòÎäî*/
                padding-bottom: 56.25%;
                /**/
                /*padding-bottom: 47.6%;*/


                /* 1.iframeÏùÑ w100Ìï¥ÎèÑ Í≤ÄÏùÄÌôîÎ©¥Ïù¥ Í∞ÄÎìùÏ∞∏.  */

                iframe {
                    position: absolute;

                    width: 100%;
                    /* Ï†ÑÏ≤¥ÌôîÎ©¥ÏúºÎ°ú Î∂ÄÎ™® padding-bottom: 56.25%; ÏùºÏãú -> height ÎßåÎïÖ    */
                    height: 100%;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);


                    /*  Î∂ÄÎ™® padding-bottom: 47.6%;ÏùºÏãú -> height ÏùºÏ†ï 100% */
                    /*     padding-bottom: 65.25vw; */
                    /*     top:50%; */
                    /*     left:50%; */
                    /*     transform: translate(-50%); */
                }
            }
        }
    }
</style>

<main class="sections" @wheel="pauseOnInteraction" @touchstart="pauseOnInteraction">
    <template x-for="(slide, i) in slides" :key="i">
        <div :id="`section-${i}`"
                class="h-screen relative"
                x-intersect.half="
                        increaseActiveSection(i); // +1Îßå ÌïòÎäîÍ≤å ÏïÑÎãàÎùº length ÎÇòÎàà Í∞í + 1Î°ú Ï≤òÏùåÎ∂ÄÌÑ∞ ÏãúÏûëÌïòÍ≤å ÌïúÎã§.
                        // ÌòÑÏû¨ activeSectionÏùò Ïä¨ÎùºÏù¥ÎìúÍ∞Ä, userInteractÌõÑ & Ï†ÑÏ≤¥ÏùåÏÜåÍ±∞Í∞Ä ÏïÑÎãàÎ©¥, ÏÜåÎ¶¨Î•º ÏºúÍ≥†,  ÎÇòÎ®∏ÏßÄ Ïä¨ÎùºÏù¥ÎìúÎäî ÏùºÏãúÏ†ïÏßÄÌïúÎã§.
                        controlVideoSection(i);
                "
        >
<!--               :class="slide.title ? 'has-title' : 'has-no-title'"-->
            <a href="#" class="block h-full w-full"
               :class="slide.title
                               ? 'has-title'
                               : (slide.youtubeId ? 'has-no-title-video' : 'has-no-title-picture')"
               @click="pauseOnInteraction"
            >
                <template x-if="slide.image">
                    <img :src="slide.image" alt="" class="block w-full h-full object-cover">
                </template>
                <template x-if="slide.youtubeId">
                    <div class="video-box block w-full h-full object-cover">
                        <iframe
                                :id="`yt-${i}`"
                                allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture;"
                                :src="`https://www.youtube.com/embed/${slide.youtubeId}?enablejsapi=1&rel=0&autoplay=1&controls=0&disablekb=1&vq=hd1440&mute=1&loop=1&playlist=${slide.youtubeId}`"
                                allowfullscreen></iframe>
                    </div>
                </template>


                <div class="absolute z-10"
                     style="left:120px; bottom:100px;"
                     x-show="slide.title"
                >
                    <p class="text-white text-5xl font-bold" x-text="slide.title"></p>
                    <p class="text-white mt-5 text-3xl" x-text="slide.subtitle"></p>
                </div>
            </a>
        </div>
    </template>
</main>

</body>
</html>